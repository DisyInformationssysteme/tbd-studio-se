<%@ jet
imports="
        java.util.Map
        org.talend.designer.codegen.config.CodeGeneratorArgument
        org.talend.core.model.process.INode
        org.talend.designer.bigdata.di.components.thbase.THBaseConfiguration
        org.talend.designer.bigdata.di.components.thbase.THbaseDeleteRows
        "
%>
    <%@ include file="@{org.talend.designer.components.localprovider}/components/templates/Log4j/Log4jFileUtil.javajet"%>
<%
    final THbaseDeleteRows thbaseDeleteRows = new THbaseDeleteRows((CodeGeneratorArgument) argument);
    THBaseConfiguration tHBaseConfiguration = new THBaseConfiguration();
    final String cid = thbaseDeleteRows.getCid();
    log4jFileUtil.componentStartInfo(thbaseDeleteRows.getNode());

    if(!thbaseDeleteRows.isUseExistingConnection()){
%>
// create hbase configuration
org.talend.bigdata.core.di.components.hbase.ImmutableTHbaseConfiguration immutableTHbaseConfiguration = org.talend.bigdata.core.di.components.hbase.ImmutableTHbaseConfiguration.builder()
.globalMap(globalMap)
<%
for (Map.Entry<String, String> entry : tHBaseConfiguration.getConnectionConfiguration(thbaseDeleteRows).entrySet()) {
%>
  .putHBaseConfigurationOptions(<%=entry.getKey()%>,<%=entry.getValue()%>)
<%
}
%>
.existingConnectionName("<%=thbaseDeleteRows.getExistingConnection()%>")
.isUseExistingConnection(<%=thbaseDeleteRows.isUseExistingConnection()%>)
.build();
immutableTHbaseConfiguration.createConfiguration();
immutableTHbaseConfiguration.createConnection();
org.apache.hadoop.hbase.client.Connection connection_<%=cid%> = immutableTHbaseConfiguration.getConnection();
 <%=tHBaseConfiguration.getKeytab(thbaseDeleteRows)%>
<% } else { %>
org.apache.hadoop.conf.Configuration conn_<%=cid%> = (org.apache.hadoop.conf.Configuration) globalMap.get("conn_<%=thbaseDeleteRows.getExistingConnection()%>");
org.apache.hadoop.hbase.client.Connection connection_<%=cid%> = org.apache.hadoop.hbase.client.ConnectionFactory.createConnection(conn_<%=cid%>);
<% } %>

resourceMap.put("connection_<%=cid%>", connection_<%=cid%>);
int nb_line_<%=cid%> = 0;


