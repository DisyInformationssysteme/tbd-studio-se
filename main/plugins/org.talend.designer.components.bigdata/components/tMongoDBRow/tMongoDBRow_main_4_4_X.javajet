<%@ jet 
	imports="
		java.util.List
		java.util.Map
	"
%>

	<%
	boolean propagate_result = "true".equalsIgnoreCase(ElementParameterParser.getValue(node, "__PROPAGATE_RESULT__"));
	%>
	
	try{
		<%if(isKeyValueCommand) {%>
			com.mongodb.BasicDBObject bsonObjectCommand_<%=cid%> = new com.mongodb.BasicDBObject();
			<%for(java.util.Map<String, String> keyValue : commandKeyValues) {%>
				bsonObjectCommand_<%=cid%>.append(<%=keyValue.get("KEY")%>, <%=keyValue.get("VALUE")%>);
				<%
			}%>
			result_<%=cid%>=db_<%=cid%>.runCommand(bsonObjectCommand_<%=cid%>);
			<%
		} else if (isJsonCommand) {%>
			result_<%=cid%> = db_<%=cid%>.runCommand(com.mongodb.BasicDBObject.parse(<%=jsonCommand%>));
			<%
		}%>
		
		<%if(propagate_result && (isKeyValueCommand || isJsonCommand)) {%>
			globalMap.put("<%=cid %>_RESULT_DOCUMENT", result_<%=cid%>);
		<%}%>

	} catch(Exception e_<%=cid%>) {
		<%if (dieOnError) {%>
			e_<%=cid%>.printStackTrace();
			throw e_<%=cid%>;
			<%
		} else {
			if(isLog4jEnabled) {%>
				log.error("<%=cid%> - " + e_<%=cid%>.getMessage());
				<%
			} else {%>
				System.err.println(e_<%=cid%>.getMessage());
			    <%
			}
		}%>
	}